<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#060814" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>–¢–∞—Ä–æ ‚Äî —Ä–∞—Å–∫–ª–∞–¥—ã 2/3/5 (–º–∞–≥–∏—á–µ—Å–∫–∞—è –≤–µ—Ä—Å–∏—è)</title>

  <link rel="manifest" href="./manifest.webmanifest">
  <link rel="apple-touch-icon" href="./icons/icon-192.png">

  <style>
    :root{
      --bg:#f7f7fb; --card:#ffffff; --ink:#0e0f13; --muted:#5b6170; --stroke:#e6e6ef;
      --brand:#6b5cff; --brand2:#34d399; --danger:#b00020;
      --dark:#060814; --dark2:#0b1020; --glow:rgba(107,92,255,.25);
      --mono: ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;
    }
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;margin:0;background:var(--bg);color:var(--ink)}
    .wrap{max-width:1160px;margin:0 auto;padding:24px}
    .card{background:var(--card);border:1px solid var(--stroke);border-radius:18px;box-shadow:0 6px 18px rgba(0,0,0,.06);padding:18px}
    h1{font-size:22px;margin:0 0 6px}
    p{margin:8px 0 0;line-height:1.45}
    .pill{display:inline-flex;gap:8px;align-items:center;padding:6px 12px;border-radius:999px;background:#eef0ff;color:#2b2f7a;font-size:12px;margin-top:10px}
    .pill b{font-weight:700}
    .topControls{display:grid;grid-template-columns:1fr 1fr 1fr 1fr;gap:10px;margin-top:14px}
    @media (max-width:980px){.topControls{grid-template-columns:1fr}}
    label{display:block;font-size:12px;color:#424857;margin:0 0 6px}
    select,input,button,textarea{width:100%;padding:10px 12px;border-radius:12px;border:1px solid #d7d7e6;background:#fff;font-size:14px;box-sizing:border-box}
    button{cursor:pointer;border:0;background:#111;color:#fff}
    button:hover{opacity:.92}
    .btnAlt{background:var(--brand)}
    .btnGhost{background:#fff;color:#111;border:1px solid #cfd2ff}
    .btnGreen{background:var(--brand2);color:#052013}
    .grid{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:12px;margin-top:14px}
    @media (max-width:980px){.grid{grid-template-columns:1fr}}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .row3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px}
    .btnRow{display:grid;grid-template-columns:1fr 1fr 1fr 1fr;gap:10px;margin-top:14px}
    @media (max-width:980px){.btnRow{grid-template-columns:1fr 1fr}}
    .out{margin-top:14px;padding:14px;border-radius:16px;background:var(--dark2);color:#f4f6ff;box-shadow:0 0 0 1px rgba(255,255,255,.06), 0 10px 30px rgba(0,0,0,.18)}
    .out h2{font-size:15px;margin:0 0 8px;color:#cdd6ff}
    .out pre{white-space:pre-wrap;margin:0;font-family:var(--mono);font-size:13px;line-height:1.45}
    .note{font-size:12px;color:var(--muted);margin-top:10px}
    .split{display:grid;grid-template-columns:1.6fr 1fr;gap:14px;margin-top:14px}
    @media (max-width:980px){.split{grid-template-columns:1fr}}
    .panel{border:1px solid var(--stroke);border-radius:16px;padding:12px;background:#fbfbff}
    .panel h3{margin:0 0 10px;font-size:14px}
    .list{max-height:320px;overflow:auto;border-radius:12px;border:1px solid var(--stroke);background:#fff}
    .item{padding:10px 10px;border-bottom:1px solid var(--stroke);cursor:pointer}
    .item:last-child{border-bottom:0}
    .item b{display:block;font-size:13px}
    .item small{display:block;color:#666;margin-top:4px}

    .offline{margin-top:10px;font-size:12px;color:#1f7a3a;display:none}
    .offline.bad{color:#b00020}

    /* Card preview */
    .previewRow{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:10px;margin-top:10px}
    @media (max-width:980px){.previewRow{grid-template-columns:1fr}}
    .tarotCard{
      border-radius:18px; padding:14px; background:linear-gradient(180deg,#0b1020 0%, #070a16 100%);
      color:#eef0ff; border:1px solid rgba(255,255,255,.10); box-shadow:0 0 0 1px rgba(107,92,255,.15), 0 14px 40px rgba(0,0,0,.28);
      position:relative; overflow:hidden;
    }
    .tarotCard:before{
      content:""; position:absolute; inset:-60px; background:radial-gradient(circle at 30% 20%, rgba(107,92,255,.35), transparent 55%),
        radial-gradient(circle at 70% 60%, rgba(52,211,153,.25), transparent 55%);
      filter: blur(0px);
    }
    .tarotCard > *{position:relative}
    .tarotTitle{font-weight:800; letter-spacing:.2px}
    .tarotSub{font-size:12px; opacity:.85; margin-top:6px}
    .tarotKeys{margin-top:10px; font-size:13px; line-height:1.35; opacity:.95}
    .chip{display:inline-block; padding:4px 10px; border-radius:999px; background:rgba(255,255,255,.08); border:1px solid rgba(255,255,255,.10); font-size:12px}
    .chips{display:flex; gap:8px; flex-wrap:wrap; margin-top:10px}

    /* Dark mode toggle (CSS variables switch) */
    body.dark{
      --bg:#060814; --card:#0b1020; --ink:#eef0ff; --muted:#b8c0e2; --stroke:rgba(255,255,255,.10);
      --glow:rgba(107,92,255,.35);
    }
    body.dark .panel{background:#0b1020}
    body.dark select, body.dark input, body.dark textarea{background:#070a16;color:#eef0ff;border:1px solid rgba(255,255,255,.14)}
    body.dark label{color:#cbd2f1}
    body.dark .btnGhost{background:#0b1020;color:#eef0ff;border:1px solid rgba(255,255,255,.14)}
    body.dark .list{background:#070a16;border:1px solid rgba(255,255,255,.14)}
    body.dark .item{border-bottom:1px solid rgba(255,255,255,.10)}
    body.dark .item small{color:#b8c0e2}
    body.dark .pill{background:rgba(107,92,255,.18); color:#eef0ff; border:1px solid rgba(107,92,255,.25)}

    /* Print styles -> save to PDF */
    @media print{
      body{background:#fff;color:#000}
      .wrap{max-width:unset;padding:0}
      .card{border:0;box-shadow:none;padding:0}
      .pill,.note,.split,.btnRow,.topControls,.grid,.row3,#net,#previewWrap,#modeWrap,#darkWrap{display:none !important}
      #out{display:block !important;background:#fff;color:#000;border:0;box-shadow:none}
      #out h2{color:#000}
      #out pre{font-size:12pt;line-height:1.35;font-family:system-ui}
    }
  </style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <h1>–¢–∞—Ä–æ ‚Äî —Ç—Ä–∞–∫—Ç–æ–≤–∫–∞ —Ä–∞—Å–∫–ª–∞–¥–∞ (2 / 3 / 5 –∫–∞—Ä—Ç)</h1>
    <p>–ú–∞–≥–∏—á–µ—Å–∫–∞—è –≤–µ—Ä—Å–∏—è: —Ç—ë–º–Ω—ã–π —Å—Ç–∏–ª—å, ‚Äú–î–∞/–ù–µ—Ç‚Äù, –∫–∞—Ä—Ç–æ—á–∫–∏‚Äë–ø—Ä–µ–≤—å—é –∏ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–π –æ—Ç—á—ë—Ç. –ü–µ—á–∞—Ç—å ‚Üí —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ PDF.</p>

    <div class="pill"><b>PWA</b> ‚Ä¢ –æ—Ñ–ª–∞–π–Ω ‚Ä¢ –∏—Å—Ç–æ—Ä–∏—è ‚Ä¢ PDF ‚Ä¢ ‚Äú–î–∞/–ù–µ—Ç‚Äù</div>
    <div id="net" class="offline">‚úì –û—Ñ–ª–∞–π–Ω-—Ä–µ–∂–∏–º –≥–æ—Ç–æ–≤</div>

    <div id="darkWrap" style="margin-top:10px;display:grid;grid-template-columns:1fr 1fr;gap:10px">
      <button id="btnDark" class="btnGhost">–¢—ë–º–Ω—ã–π —Ä–µ–∂–∏–º: –í–ö–õ/–í–´–ö–õ</button>
      <button id="btnReset" class="btnGhost">–°–±—Ä–æ—Å–∏—Ç—å –ø–æ–ª—è</button>
    </div>

    <div id="modeWrap" class="topControls">
      <div>
        <label for="mode">–†–µ–∂–∏–º</label>
        <select id="mode">
          <option value="interpret" selected>–¢—Ä–∞–∫—Ç–æ–≤–∫–∞</option>
          <option value="yesno">–î–∞ / –ù–µ—Ç</option>
          <option value="client">–ö–ª–∏–µ–Ω—Ç—Å–∫–∏–π –æ—Ç—á—ë—Ç</option>
        </select>
      </div>
      <div>
        <label for="spread">–†–∞—Å–∫–ª–∞–¥</label>
        <select id="spread">
          <option value="2">2 –∫–∞—Ä—Ç—ã</option>
          <option value="3" selected>3 –∫–∞—Ä—Ç—ã</option>
          <option value="5">5 –∫–∞—Ä—Ç</option>
        </select>
      </div>
      <div>
        <label for="themeAll">–¢–µ–º–∞ (–æ–±—â–∞—è)</label>
        <select id="themeAll">
          <option value="general">–û–±—â–µ–µ</option>
          <option value="love">–õ—é–±–æ–≤—å</option>
          <option value="money">–î–µ–Ω—å–≥–∏/—Ä–∞–±–æ—Ç–∞</option>
        </select>
      </div>
      <div>
        <label for="layout">–°–º—ã—Å–ª –ø–æ–∑–∏—Ü–∏–π</label>
        <select id="layout">
          <option value="pni" selected>–ü—Ä–∏—á–∏–Ω–∞ ‚Üí –°—É—Ç—å ‚Üí –ò—Ç–æ–≥</option>
          <option value="pastpresentfuture">–ü—Ä–æ—à–ª–æ–µ ‚Üí –ù–∞—Å—Ç–æ—è—â–µ–µ ‚Üí –ë—É–¥—É—â–µ–µ</option>
          <option value="situationadviceoutcome">–°–∏—Ç—É–∞—Ü–∏—è ‚Üí –°–æ–≤–µ—Ç ‚Üí –ò—Ç–æ–≥</option>
        </select>
      </div>
    </div>

    <div class="row" style="margin-top:10px">
      <div>
        <label for="question">–í–æ–ø—Ä–æ—Å (–¥–ª—è ‚Äú–î–∞/–ù–µ—Ç‚Äù –∏ –æ—Ç—á—ë—Ç–∞)</label>
        <input id="question" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: ‚Äú–°—Ç–æ–∏—Ç –ª–∏ –º–µ–Ω—è—Ç—å —Ä–∞–±–æ—Ç—É –≤ –±–ª–∏–∂–∞–π—à–∏–µ 3 –º–µ—Å—è—Ü–∞?‚Äù">
      </div>
      <div>
        <label for="style">–°—Ç–∏–ª—å –æ—Ç–≤–µ—Ç–∞</label>
        <select id="style">
          <option value="soft" selected>–ú—è–≥–∫–æ</option>
          <option value="direct">–ü—Ä—è–º–æ</option>
          <option value="short">–ö–æ—Ä–æ—Ç–∫–æ</option>
        </select>
      </div>
    </div>

    <div id="cardsContainer" class="grid"></div>

    <div id="previewWrap" class="previewRow"></div>

    <div class="btnRow">
      <button id="btnGo">–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å</button>
      <button id="btnCopy" class="btnAlt">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
      <button id="btnPrint" class="btnGhost">–ü–µ—á–∞—Ç—å / PDF</button>
      <button id="btnSave" class="btnGreen">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –∏—Å—Ç–æ—Ä–∏—é</button>
    </div>

    <div class="row3" style="margin-top:10px">
      <div>
        <label for="title">–ú–µ—Ç–∫–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: ‚Äú—Ä–∞–±–æ—Ç–∞‚Äù, ‚Äú–æ—Ç–Ω–æ—à–µ–Ω–∏—è‚Äù)</label>
        <input id="title" placeholder="–ú–µ—Ç–∫–∞ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)">
      </div>
      <div>
        <label for="client">–ò–º—è (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)</label>
        <input id="client" placeholder="–ò–º—è (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)">
      </div>
      <div>
        <label>&nbsp;</label>
        <select id="lang">
          <option value="ru" selected>–Ø–∑—ã–∫: RU</option>
        </select>
      </div>
    </div>

    <div class="out" id="out" style="display:none">
      <h2>–†–µ–∑—É–ª—å—Ç–∞—Ç</h2>
      <pre id="txt"></pre>
    </div>

    <div class="split">
      <div class="panel">
        <h3>–ò—Å—Ç–æ—Ä–∏—è</h3>
        <div class="list" id="history"></div>
        <div class="row" style="margin-top:10px">
          <button id="btnExport" class="btnGhost">–≠–∫—Å–ø–æ—Ä—Ç (JSON)</button>
          <button id="btnClear" style="background:var(--danger)">–û—á–∏—Å—Ç–∏—Ç—å</button>
        </div>
        <div style="margin-top:10px">
          <label for="import">–ò–º–ø–æ—Ä—Ç (–≤—Å—Ç–∞–≤—å—Ç–µ JSON)</label>
          <textarea id="import" rows="4"></textarea>
          <button id="btnImport" class="btnAlt" style="margin-top:8px">–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
        </div>
      </div>

      <div class="panel">
        <h3>iPhone: —É—Å—Ç–∞–Ω–æ–≤–∫–∞ PWA</h3>
        <ol style="margin:0;padding-left:18px;line-height:1.35">
          <li>–û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ <b>Safari</b> –ø–æ <b>HTTPS</b>-—Å—Å—ã–ª–∫–µ.</li>
          <li><b>–ü–æ–¥–µ–ª–∏—Ç—å—Å—è</b> ‚Üí <b>–ù–∞ —ç–∫—Ä–∞–Ω –î–æ–º–æ–π</b>.</li>
          <li>–ó–∞–ø—É—Å–∫–∞–π—Ç–µ —Å –∏–∫–æ–Ω–∫–∏ ‚Äî –æ—Ñ–ª–∞–π–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.</li>
        </ol>
        <p class="note">PDF: –Ω–∞–∂–º–∏—Ç–µ ‚Äú–ü–µ—á–∞—Ç—å / PDF‚Äù ‚Üí –≤ –æ–∫–Ω–µ –ø–µ—á–∞—Ç–∏ iOS –≤—ã–±–µ—Ä–∏—Ç–µ ‚Äú–ü–æ–¥–µ–ª–∏—Ç—å—Å—è/–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ —Ñ–∞–π–ª—ã‚Äù.</p>
      </div>
    </div>

    <div class="note">
      üé¥ ‚Äú–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–∞—Ä—Ç‚Äù: –∑–¥–µ—Å—å —Å–¥–µ–ª–∞–Ω—ã –∫—Ä–∞—Å–∏–≤—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏‚Äë–ø—Ä–µ–≤—å—é (–±–µ–∑ —á—É–∂–æ–π –≥—Ä–∞—Ñ–∏–∫–∏), —á—Ç–æ–±—ã –±—ã–ª–æ –æ—Ñ–ª–∞–π–Ω –∏ –±–µ–∑ –ø—Ä–æ–±–ª–µ–º —Å –∞–≤—Ç–æ—Ä—Å–∫–∏–º–∏ –ø—Ä–∞–≤–∞–º–∏.
      –ï—Å–ª–∏ –∑–∞—Ö–æ—Ç–∏—Ç–µ –∏–º–µ–Ω–Ω–æ –∫–∞—Ä—Ç–∏–Ω–∫–∏ Rider‚ÄëWaite ‚Äî —Å–∫–∞–∂–µ—Ç–µ, —Å–¥–µ–ª–∞—é –≤–∞—Ä–∏–∞–Ω—Ç —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º –≤–∞—à–∏—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π.
    </div>
  </div>
</div>

<script>
  // --- Data (keys) ---
  const MAJORS = [
    {name:"0 –®—É—Ç", score: +2, keys:{general:["–Ω–æ–≤—ã–π —Å—Ç–∞—Ä—Ç","—Å–≤–æ–±–æ–¥–∞","—Å–ø–æ–Ω—Ç–∞–Ω–Ω–æ—Å—Ç—å"], love:["–ª–µ–≥–∫–æ—Å—Ç—å","—Ñ–ª–∏—Ä—Ç","–≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å —Ä–∏—Å–∫–Ω—É—Ç—å"], money:["–Ω–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏","—Å—Ç–∞—Ä—Ç–∞–ø","—ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç"]},
      rev:{general:["–±–µ–∑–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å","—Ö–∞–æ—Å","–Ω–∞–∏–≤–Ω–æ—Å—Ç—å"], love:["–Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å","–Ω–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ—Å—Ç—å"], money:["—Ä–∏—Å–∫–∏ –±–µ–∑ –ø–ª–∞–Ω–∞","–ø–æ—Å–ø–µ—à–Ω–æ—Å—Ç—å"]}},
    {name:"I –ú–∞–≥", score:+3, keys:{general:["–≤–æ–ª—è","–∏–Ω–∏—Ü–∏–∞—Ç–∏–≤–∞","—Ä–µ—Å—É—Ä—Å—ã –≤ —Ä—É–∫–∞—Ö"], love:["–∞–∫—Ç–∏–≤–Ω—ã–π —à–∞–≥","–ø—Ä–∏—Ç—è–∂–µ–Ω–∏–µ","–ø—Ä–æ—è—Å–Ω–µ–Ω–∏–µ"], money:["–ø–µ—Ä–µ–≥–æ–≤–æ—Ä—ã","—É–º–µ–Ω–∏–µ –ø—Ä–æ–¥–∞–≤–∞—Ç—å","–∑–∞–ø—É—Å–∫"]},
      rev:{general:["–º–∞–Ω–∏–ø—É–ª—è—Ü–∏–∏","—Å–∞–º–æ–æ–±–º–∞–Ω","—Ä–∞—Å—Ç—Ä–∞—Ç–∞ —Å–∏–ª"], love:["–∏–≥—Ä—ã","–¥–∞–≤–ª–µ–Ω–∏–µ"], money:["–ø—Ä–æ–≤–∞–ª —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏","–Ω–µ—á–µ—Å—Ç–Ω–æ—Å—Ç—å"]}},
    {name:"II –ñ—Ä–∏—Ü–∞", score:+1, keys:{general:["–∏–Ω—Ç—É–∏—Ü–∏—è","—Ç–∞–π–Ω–∞","–≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ –∑–Ω–∞–Ω–∏–µ"], love:["—á—É–≤—Å—Ç–≤–∞ –≥–ª—É–±–∂–µ —Å–ª–æ–≤","–∑–∞–∫—Ä—ã—Ç–æ—Å—Ç—å","–æ–∂–∏–¥–∞–Ω–∏–µ"], money:["–∞–Ω–∞–ª–∏–∑","–æ—Å—Ç–æ—Ä–æ–∂–Ω–æ—Å—Ç—å","–¥–µ—Ç–∞–ª–∏"]},
      rev:{general:["–ø—É—Ç–∞–Ω–∏—Ü–∞","–∏–≥–Ω–æ—Ä –∏–Ω—Ç—É–∏—Ü–∏–∏","–≤—Å–∫—Ä—ã—Ç–∏–µ —Ç–∞–π–Ω"], love:["–Ω–µ–¥–æ–≤–µ—Ä–∏–µ","—Ä–µ–≤–Ω–æ—Å—Ç—å"], money:["–æ—à–∏–±–∫–∏","–Ω–µ–≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å"]}},
    {name:"III –ò–º–ø–µ—Ä–∞—Ç—Ä–∏—Ü–∞", score:+4, keys:{general:["—Ä–æ—Å—Ç","–∑–∞–±–æ—Ç–∞","–∏–∑–æ–±–∏–ª–∏–µ"], love:["—Ç–µ–ø–ª–æ","—Å–µ–º–µ–π–Ω–æ—Å—Ç—å","–ø–ª–æ–¥ –æ—Ç–Ω–æ—à–µ–Ω–∏–π"], money:["–ø—Ä–∏–±—ã–ª—å","–ø—Ä–æ–µ–∫—Ç —Ä–∞—Å—Ç—ë—Ç","–∫–æ–º—Ñ–æ—Ä—Ç"]},
      rev:{general:["–∑–∞—Å—Ç–æ–π","–ø–µ—Ä–µ—Ä–∞—Å—Ö–æ–¥","–ª–µ–Ω–æ—Å—Ç—å"], love:["–∫–æ–Ω—Ç—Ä–æ–ª—å","–æ—Å—Ç—ã–≤–∞–Ω–∏–µ"], money:["—Ç—Ä–∞—Ç—ã","–Ω–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å"]}},
    {name:"IV –ò–º–ø–µ—Ä–∞—Ç–æ—Ä", score:+2, keys:{general:["—Å—Ç—Ä—É–∫—Ç—É—Ä–∞","–∫–æ–Ω—Ç—Ä–æ–ª—å","–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å"], love:["–≥—Ä–∞–Ω–∏—Ü—ã","—Å–µ—Ä—å–µ–∑–Ω–æ—Å—Ç—å","–æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å"], money:["—Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å","—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ","–∫–∞—Ä—å–µ—Ä–∞"]},
      rev:{general:["–∂–µ—Å—Ç–∫–æ—Å—Ç—å","—Ç–∏—Ä–∞–Ω–∏—è","–ø–æ—Ç–µ—Ä—è –∫–æ–Ω—Ç—Ä–æ–ª—è"], love:["—Ö–æ–ª–æ–¥","–¥–∞–≤–ª–µ–Ω–∏–µ"], money:["–∫–æ–Ω—Ñ–ª–∏–∫—Ç","—Ä–∏—Å–∫–∏ —Å—Ç–∞—Ç—É—Å–∞"]}},
    {name:"V –ò–µ—Ä–æ—Ñ–∞–Ω—Ç", score:+1, keys:{general:["—Ç—Ä–∞–¥–∏—Ü–∏–∏","—É—á–∏—Ç–µ–ª—å","–ø—Ä–∞–≤–∏–ª–∞"], love:["–æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π —Å–æ—é–∑","—Ü–µ–Ω–Ω–æ—Å—Ç–∏","—Å–µ–º—å—è"], money:["—Å–∏—Å—Ç–µ–º–∞","–æ–±—É—á–µ–Ω–∏–µ","—Å—Ç—Ä—É–∫—Ç—É—Ä–∞"]},
      rev:{general:["–±—É–Ω—Ç","–ª–∏—Ü–µ–º–µ—Ä–∏–µ","—Å–≤–æ–∏ –ø—Ä–∞–≤–∏–ª–∞"], love:["—Ä–∞–∑–Ω—ã–µ —Ü–µ–Ω–Ω–æ—Å—Ç–∏","—Å–∫—Ä—ã—Ç–Ω–æ—Å—Ç—å"], money:["–æ–±—Ö–æ–¥ –ø—Ä–∞–≤–∏–ª","–Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ"]}},
    {name:"VI –í–ª—é–±–ª—ë–Ω–Ω—ã–µ", score:+4, keys:{general:["–≤—ã–±–æ—Ä","—Å–æ—é–∑","–≥–∞—Ä–º–æ–Ω–∏—è"], love:["–≤–∑–∞–∏–º–Ω–æ—Å—Ç—å","–ø—Ä–∏–∑–Ω–∞–Ω–∏–µ","—Å–±–ª–∏–∂–µ–Ω–∏–µ"], money:["–ø–∞—Ä—Ç–Ω—ë—Ä—Å—Ç–≤–æ","—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ","–≤—ã–±–æ—Ä"]},
      rev:{general:["—Å–æ–º–Ω–µ–Ω–∏—è","–¥–∏—Å–±–∞–ª–∞–Ω—Å","—Ç—Ä–µ—Ç—å–∏ –ª–∏—Ü–∞"], love:["–Ω–µ–≤–µ—Ä–Ω–æ—Å—Ç—å","—Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ"], money:["–Ω–µ–≤—ã–≥–æ–¥–Ω–æ","—Ä–∞–∑–Ω–æ–≥–ª–∞—Å–∏—è"]}},
    {name:"VII –ö–æ–ª–µ—Å–Ω–∏—Ü–∞", score:+3, keys:{general:["–¥–≤–∏–∂–µ–Ω–∏–µ","–ø–æ–±–µ–¥–∞","–∫—É—Ä—Å"], love:["—Ä–µ—à–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å","—à–∞–≥ –Ω–∞–≤—Å—Ç—Ä–µ—á—É","–ø–æ–µ–∑–¥–∫–∞"], money:["–ø—Ä–æ—Ä—ã–≤","–ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏–µ","—Ü–µ–ª—å"]},
      rev:{general:["—Å—Ä—ã–≤","—Å–ø–µ—à–∫–∞","–ø–æ—Ç–µ—Ä—è –∫—É—Ä—Å–∞"], love:["–¥–∞–≤–ª–µ–Ω–∏–µ","—Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏–µ"], money:["–ø–µ—Ä–µ–≥–æ—Ä–∞–Ω–∏–µ","–ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è"]}},
    {name:"VIII –°–∏–ª–∞", score:+3, keys:{general:["—Å—Ç–æ–π–∫–æ—Å—Ç—å","—Å–º–µ–ª–æ—Å—Ç—å","–º—è–≥–∫–∞—è –≤–ª–∞—Å—Ç—å"], love:["—Å—Ç—Ä–∞—Å—Ç—å","—Ç–µ—Ä–ø–µ–Ω–∏–µ","–ø—Ä–∏–Ω—è—Ç–∏–µ"], money:["–≤—ã–¥–µ—Ä–∂–∫–∞","–ø–µ—Ä–µ–≥–æ–≤–æ—Ä—ã","–¥–æ–ª–≥–∞—è –∏–≥—Ä–∞"]},
      rev:{general:["—Å—Ç—Ä–∞—Ö","–≤—Å–ø—ã–ª—å—á–∏–≤–æ—Å—Ç—å","—Å–ª–∞–±–æ—Å—Ç—å"], love:["—Ä–µ–≤–Ω–æ—Å—Ç—å","–Ω–µ—É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å"], money:["—ç–º–æ—Ü–∏–∏","—Å—Ä—ã–≤—ã"]}},
    {name:"IX –û—Ç—à–µ–ª—å–Ω–∏–∫", score:-1, keys:{general:["–ø–∞—É–∑–∞","–ø–æ–∏—Å–∫ —Å–º—ã—Å–ª–∞","—É–µ–¥–∏–Ω–µ–Ω–∏–µ"], love:["–¥–∏—Å—Ç–∞–Ω—Ü–∏—è","–ø–µ—Ä–µ–æ—Å–º—ã—Å–ª–µ–Ω–∏–µ","–æ—Å—Ç–æ—Ä–æ–∂–Ω–æ—Å—Ç—å"], money:["–∞–Ω–∞–ª–∏–∑","—ç–∫–æ–Ω–æ–º–∏—è","–æ–¥–∏–Ω–æ—á–Ω–æ"]},
      rev:{general:["–∏–∑–æ–ª—è—Ü–∏—è","–∑–∞—Å—Ç—Ä–µ–≤–∞–Ω–∏–µ","–∑–∞–∫—Ä—ã—Ç–æ—Å—Ç—å"], love:["—Ö–æ–ª–æ–¥","—É—Ö–æ–¥"], money:["—É–ø—É—â–µ–Ω–æ"]}},
    {name:"X –ö–æ–ª–µ—Å–æ –§–æ—Ä—Ç—É–Ω—ã", score:+2, keys:{general:["–ø–æ–≤–æ—Ä–æ—Ç —Å—É–¥—å–±—ã","—Ü–∏–∫–ª","—à–∞–Ω—Å"], love:["—Å–º–µ–Ω–∞ —ç—Ç–∞–ø–∞","–Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–æ—Å—Ç—å","—Å—É–¥—å–±–æ–Ω–æ—Å–Ω–æ"], money:["—É–¥–∞—á–∞","–æ–∫–Ω–æ","—Ä—ã–Ω–æ–∫"]},
      rev:{general:["–∑–∞–¥–µ—Ä–∂–∫–∏","–Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ","–Ω–µ –≤—Ä–µ–º—è"], love:["–∫–∞—á–µ–ª–∏","–ø–æ–≤—Ç–æ—Ä"], money:["–≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å","–ø–æ—Ç–µ—Ä–∏"]}},
    {name:"XI –°–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ—Å—Ç—å", score:+1, keys:{general:["–±–∞–ª–∞–Ω—Å","–∑–∞–∫–æ–Ω","—á–µ—Å—Ç–Ω–æ—Å—Ç—å"], love:["–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å","–ø–æ —Ñ–∞–∫—Ç–∞–º","—è—Å–Ω–æ—Å—Ç—å"], money:["–¥–æ–∫—É–º–µ–Ω—Ç—ã","–∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã","—Ä–∞—Å—á—ë—Ç"]},
      rev:{general:["–ø–µ—Ä–µ–∫–æ—Å","–Ω–µ—Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ","—Å—É–¥"], love:["–æ–±–∏–¥—ã","–Ω–µ—á–µ—Å—Ç–Ω–æ"], money:["—à—Ç—Ä–∞—Ñ—ã","–æ—à–∏–±–∫–∏"]}},
    {name:"XII –ü–æ–≤–µ—à–µ–Ω–Ω—ã–π", score:-1, keys:{general:["–ø–∞—É–∑–∞","–Ω–æ–≤—ã–π –≤–∑–≥–ª—è–¥","–ø–µ—Ä–µ–æ—Ü–µ–Ω–∫–∞"], love:["–æ–∂–∏–¥–∞–Ω–∏–µ","—É—Å—Ç—É–ø–∫–∞","–ø–µ—Ä–µ–æ—Å–º—ã—Å–ª–µ–Ω–∏–µ"], money:["–∑–∞–º–æ—Ä–æ–∑–∫–∞","–ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞","—Ç–µ—Ä–ø–µ–Ω–∏–µ"]},
      rev:{general:["–∑–∞—Å—Ç–æ–π","—É–ø—Ä—è–º—Å—Ç–≤–æ","–≤–ø—É—Å—Ç—É—é"], love:["—Å–æ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å","–∑–∞—Ç—è–∂–∫–∞"], money:["–ø–æ—Ç–µ—Ä—è –≤—Ä–µ–º–µ–Ω–∏"]}},
    {name:"XIII –°–º–µ—Ä—Ç—å", score:0, keys:{general:["–∫–æ–Ω–µ—Ü —ç—Ç–∞–ø–∞","–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ","–ø–µ—Ä–µ—Ä–æ–∂–¥–µ–Ω–∏–µ"], love:["–∑–∞–∫—Ä—ã—Ç–∏–µ –ø—Ä–æ—à–ª–æ–≥–æ","–Ω–æ–≤–∞—è –≥–ª–∞–≤–∞","–ø–µ—Ä–µ—Ö–æ–¥"], money:["—Ä–µ–æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è","–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫","—Ä–µ–∑–∫–æ"]},
      rev:{general:["—Å—Ç—Ä–∞—Ö –ø–µ—Ä–µ–º–µ–Ω","—Ü–µ–ø–ª—è–Ω–∏–µ","–∑–∞—Ç—è–∂–Ω–æ–π —Ñ–∏–Ω–∞–ª"], love:["–Ω–µ –æ—Ç–ø—É—Å–∫–∞–µ—Ç"], money:["—Å–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏–µ"]}},
    {name:"XIV –£–º–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å", score:+2, keys:{general:["–≥–∞—Ä–º–æ–Ω–∏—è","–∏—Å—Ü–µ–ª–µ–Ω–∏–µ","–ø–ª–∞–≤–Ω–æ—Å—Ç—å"], love:["–∫–æ–º–ø—Ä–æ–º–∏—Å—Å","–º–∏—Ä","–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ"], money:["—Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—è","–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è","—Ä–∏—Ç–º"]},
      rev:{general:["–Ω–µ—Ç –º–µ—Ä—ã","–ø–µ—Ä–µ–∫–æ—Å","—Å—Ä—ã–≤"], love:["–Ω–µ—Ç —Å–æ–≥–ª–∞—Å–∏—è"], money:["—Ä–∞–∑–±–∞–ª–∞–Ω—Å"]}},
    {name:"XV –î—å—è–≤–æ–ª", score:-3, keys:{general:["–∏—Å–∫—É—à–µ–Ω–∏–µ","–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏","–º–∞—Ç–µ—Ä–∏—è"], love:["—Å—Ç—Ä–∞—Å—Ç—å","–ø—Ä–∏–≤—è–∑–∫–∞","—Ä–µ–≤–Ω–æ—Å—Ç—å"], money:["–∫—Ä—É–ø–Ω—ã–µ –¥–µ–Ω—å–≥–∏","—Ä–∏—Å–∫–∏","–∫—Ä–µ–¥–∏—Ç—ã"]},
      rev:{general:["–æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ","—Ä–∞–∑—Ä—ã–≤ —Ü–µ–ø–µ–π","—Ç—Ä–µ–∑–≤–æ—Å—Ç—å"], love:["–≤—ã—Ö–æ–¥ –∏–∑ —Ç–æ–∫—Å–∏—á–Ω–æ—Å—Ç–∏"], money:["–≤—ã—Ö–æ–¥ –∏–∑ —Å—Ö–µ–º"]}},
    {name:"XVI –ë–∞—à–Ω—è", score:-4, keys:{general:["–∫—Ä–∏–∑–∏—Å","–ª–æ–º–∫–∞","–≤—Å–∫—Ä—ã—Ç–∏–µ –ø—Ä–∞–≤–¥—ã"], love:["—Å–∫–∞–Ω–¥–∞–ª","—Ä–µ–∑–∫–æ","—Ä–∞–∑—Ä—ã–≤"], money:["–æ–±–≤–∞–ª","—Å—Ä—ã–≤","—Ä–∞—Å—Ö–æ–¥—ã"]},
      rev:{general:["–Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ","—Ö—Ä—É–ø–∫–æ—Å—Ç—å","–æ—Ç–ª–æ–∂–µ–Ω–æ"], love:["–ø–æ–¥–∞–≤–ª–µ–Ω–æ"], money:["—Ä–∏—Å–∫–∏ —Ä–∞—Å—Ç—É—Ç"]}},
    {name:"XVII –ó–≤–µ–∑–¥–∞", score:+3, keys:{general:["–Ω–∞–¥–µ–∂–¥–∞","–≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏–µ","–ø—É—Ç—å"], love:["—Ä–æ–º–∞–Ω—Ç–∏–∫–∞","–∏—Å—Ü–µ–ª–µ–Ω–∏–µ","–≤–µ—Ä–∞"], money:["–ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤–∞","—Ä–µ–ø—É—Ç–∞—Ü–∏—è","—Ä–æ—Å—Ç"]},
      rev:{general:["—Å–æ–º–Ω–µ–Ω–∏—è","—Ä–∞–∑–æ—á–∞—Ä–æ–≤–∞–Ω–∏–µ","—Ç—É—Å–∫–Ω–µ–µ—Ç"], love:["–∏–¥–µ–∞–ª–∏–∑–∞—Ü–∏—è","–æ—Ö–ª–∞–∂–¥–µ–Ω–∏–µ"], money:["–Ω–µ—Ç –≤–µ—Ä—ã"]}},
    {name:"XVIII –õ—É–Ω–∞", score:-2, keys:{general:["–∏–ª–ª—é–∑–∏–∏","—Å—Ç—Ä–∞—Ö–∏","–ø–æ–¥—Å–æ–∑–Ω–∞–Ω–∏–µ"], love:["—Ç–∞–π–Ω—ã","—Å–æ–º–Ω–µ–Ω–∏—è","—ç–º–æ—Ü–∏–∏"], money:["—Ç—É–º–∞–Ω","–æ–±–º–∞–Ω","–Ω–µ—è—Å–Ω–æ—Å—Ç—å"]},
      rev:{general:["–ø—Ä–æ—è—Å–Ω–µ–Ω–∏–µ","—Ñ–∞–∫—Ç—ã","–≤—ã—Ö–æ–¥ –∏–∑ —Å—Ç—Ä–∞—Ö–æ–≤"], love:["–æ—Ç–∫—Ä–æ–≤–µ–Ω–Ω–æ—Å—Ç—å"], money:["–ø—Ä–∞–≤–¥–∞"]}},
    {name:"XIX –°–æ–ª–Ω—Ü–µ", score:+5, keys:{general:["—É—Å–ø–µ—Ö","—Ä–∞–¥–æ—Å—Ç—å","—è—Å–Ω–æ—Å—Ç—å"], love:["—Å—á–∞—Å—Ç—å–µ","–æ—Ç–∫—Ä—ã—Ç–æ—Å—Ç—å","—Ç–µ–ø–ª–æ"], money:["–ø—Ä–∏–±—ã–ª—å","–ø—Ä–∏–∑–Ω–∞–Ω–∏–µ","—Ä–æ—Å—Ç"]},
      rev:{general:["–≤—ã–≥–æ—Ä–∞–Ω–∏–µ","–≥–æ—Ä–¥—ã–Ω—è","–∑–∞–¥–µ—Ä–∂–∫–∞"], love:["—ç–≥–æ","–Ω–µ–¥–æ—Å–∫–∞–∑–∞–Ω–Ω–æ—Å—Ç—å"], money:["–ø–µ—Ä–µ—Ä–∞—Å—Ö–æ–¥"]}},
    {name:"XX –°—É–¥", score:+2, keys:{general:["–ø—Ä–æ–±—É–∂–¥–µ–Ω–∏–µ","—Ä–µ—à–µ–Ω–∏–µ","–≤—Ç–æ—Ä–æ–π —à–∞–Ω—Å"], love:["—Ä–∞–∑–≥–æ–≤–æ—Ä –ø–æ —Å—É—Ç–∏","–≤–æ–∑–≤—Ä–∞—Ç","–ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞"], money:["–∏—Ç–æ–≥–∏","–∞—É–¥–∏—Ç","–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫"]},
      rev:{general:["—Å—Ç—Ä–∞—Ö –æ—Ü–µ–Ω–∫–∏","–∑–∞—Å—Ç—Ä–µ–≤–∞–Ω–∏–µ","–Ω–µ —Å–ª—ã—à–∏—Ç"], love:["–æ–±–∏–¥—ã","–Ω–µ –≥–æ—Ç–æ–≤"], money:["–Ω–µ –∑–∞–∫—Ä—ã—Ç–æ"]}},
    {name:"XXI –ú–∏—Ä", score:+4, keys:{general:["–∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ","—Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å","—É—Ä–æ–≤–µ–Ω—å"], love:["–∑—Ä–µ–ª—ã–π —Å–æ—é–∑","–≥–∞—Ä–º–æ–Ω–∏—è","–∏—Ç–æ–≥"], money:["–∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞","—Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ","–º–∞—Å—à—Ç–∞–±"]},
      rev:{general:["–Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω–Ω–æ—Å—Ç—å","–ø–µ—Ç–ª—è","–Ω–µ—Ç —Ç–æ—á–∫–∏"], love:["–Ω–µ –≥–æ—Ç–æ–≤–æ"], money:["–∑–∞–≤–∏—Å–ª–æ"]}},
  ].map(x=>({...x,type:"major"}));

  const SUITS = [
    {suit:"–ñ–µ–∑–ª–æ–≤", score:+1, g:["–¥–µ–π—Å—Ç–≤–∏–µ","—ç–Ω–µ—Ä–≥–∏—è"], l:["–∏–Ω–∏—Ü–∏–∞—Ç–∏–≤–∞","—Å—Ç—Ä–∞—Å—Ç—å"], m:["—Ä–æ—Å—Ç","–ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏–µ"]},
    {suit:"–ö—É–±–∫–æ–≤", score:+1, g:["—á—É–≤—Å—Ç–≤–∞","–æ—Ç–Ω–æ—à–µ–Ω–∏—è"], l:["—ç–º–æ—Ü–∏–∏","–ª—é–±–æ–≤—å"], m:["–∫–ª–∏–µ–Ω—Ç—ã","—Å–µ—Ä–≤–∏—Å"]},
    {suit:"–ú–µ—á–µ–π", score:0, g:["–º—ã—Å–ª–∏","–≤—ã–±–æ—Ä"], l:["—Ä–∞–∑–≥–æ–≤–æ—Ä","–≥—Ä–∞–Ω–∏—Ü—ã"], m:["—Ä–µ—à–µ–Ω–∏–µ","–∫–æ–Ω—Ç—Ä–∞–∫—Ç"]},
    {suit:"–ü–µ–Ω—Ç–∞–∫–ª–µ–π", score:+1, g:["–º–∞—Ç–µ—Ä–∏—è","–±—ã—Ç"], l:["—Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å","–∑–∞–±–æ—Ç–∞"], m:["–¥–µ–Ω—å–≥–∏","—Ä–µ–∑—É–ª—å—Ç–∞—Ç"]},
  ];
  const RANKS = [
    {rank:"–¢—É–∑", score:+2, g:["–Ω–∞—á–∞–ª–æ","—à–∞–Ω—Å"], l:["–∏—Å–∫—Ä–∞","–ø–µ—Ä–≤—ã–π —à–∞–≥"], m:["–Ω–æ–≤—ã–π –ø–æ—Ç–æ–∫"]},
    {rank:"2", score:+1, g:["–±–∞–ª–∞–Ω—Å","–≤—ã–±–æ—Ä"], l:["—Å–±–ª–∏–∂–µ–Ω–∏–µ/–ø–∞—É–∑–∞"], m:["–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ"]},
    {rank:"3", score:+2, g:["—Ä–æ—Å—Ç","–∫–æ–º–∞–Ω–¥–∞"], l:["–ø–æ–¥–¥–µ—Ä–∂–∫–∞"], m:["–ø—Ä–æ–µ–∫—Ç"]},
    {rank:"4", score:+1, g:["—Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å","–ø–∞—É–∑–∞"], l:["–¥–æ–º/–≥—Ä–∞–Ω–∏—Ü—ã"], m:["—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ"]},
    {rank:"5", score:-2, g:["–∫—Ä–∏–∑–∏—Å","–∫–æ–Ω—Ñ–ª–∏–∫—Ç"], l:["—Å—Å–æ—Ä–∞/—Ä–µ–≤–Ω–æ—Å—Ç—å"], m:["–ø–æ—Ç–µ—Ä–∏/–±–æ—Ä—å–±–∞"]},
    {rank:"6", score:+2, g:["—É–ª—É—á—à–µ–Ω–∏–µ","–¥–≤–∏–∂–µ–Ω–∏–µ"], l:["–≥–∞—Ä–º–æ–Ω–∏—è/—Å–≤–∏–¥–∞–Ω–∏–µ"], m:["–ø—Ä–æ–≥—Ä–µ—Å—Å"]},
    {rank:"7", score:0, g:["–∏—Å–ø—ã—Ç–∞–Ω–∏–µ","–∑–∞—â–∏—Ç–∞"], l:["—Å–æ–º–Ω–µ–Ω–∏—è"], m:["–∫–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏—è"]},
    {rank:"8", score:+2, g:["—Å–∫–æ—Ä–æ—Å—Ç—å","—Ä–∞–±–æ—Ç–∞"], l:["—Å–æ–æ–±—â–µ–Ω–∏—è"], m:["–∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å"]},
    {rank:"9", score:0, g:["–ø—Ä–µ–¥–µ–ª","–æ–ø—ã—Ç"], l:["–≥–ª—É–±–∏–Ω–∞/—Ç—Ä–µ–≤–æ–≥–∞"], m:["–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å"]},
    {rank:"10", score:0, g:["–∏—Ç–æ–≥","–ø–µ—Ä–µ–≥—Ä—É–∑"], l:["–∫—É–ª—å–º–∏–Ω–∞—Ü–∏—è"], m:["—Ñ–∏–Ω–∞–ª —ç—Ç–∞–ø–∞"]},
    {rank:"–ü–∞–∂", score:+1, g:["–Ω–æ–≤–æ—Å—Ç—å","—É—á–µ–Ω–∏–∫"], l:["—Å–æ–æ–±—â–µ–Ω–∏–µ","–∏–Ω—Ç–µ—Ä–µ—Å"], m:["–∏–¥–µ—è/—Å—Ç–∞—Ä—Ç"]},
    {rank:"–†—ã—Ü–∞—Ä—å", score:+1, g:["—Ä—ã–≤–æ–∫","–¥–≤–∏–∂–µ–Ω–∏–µ"], l:["–ø–æ—Ä—ã–≤"], m:["–∏–Ω–∏—Ü–∏–∞—Ç–∏–≤–∞"]},
    {rank:"–ö–æ—Ä–æ–ª–µ–≤–∞", score:+1, g:["–∑–∞–±–æ—Ç–∞","–∏–Ω—Ç—É–∏—Ü–∏—è"], l:["–∂–µ–Ω—Å–∫–∞—è —ç–Ω–µ—Ä–≥–∏—è"], m:["—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º—è–≥–∫–æ"]},
    {rank:"–ö–æ—Ä–æ–ª—å", score:+1, g:["–∫–æ–Ω—Ç—Ä–æ–ª—å","—Ä–µ—à–µ–Ω–∏–µ"], l:["–æ–ø–æ—Ä–∞/–ª–∏–¥–µ—Ä"], m:["—Ä–µ–∑—É–ª—å—Ç–∞—Ç"]},
  ];

  function makeMinor(){
    const out=[];
    for(const s of SUITS){
      for(const r of RANKS){
        out.push({
          name:`${r.rank} ${s.suit}`, type:"minor", suit:s.suit, rank:r.rank,
          score:(s.score + r.score),
          keys:{general:[...r.g,...s.g], love:[...r.l,...s.l], money:[...r.m,...s.m]},
          rev:{general:["–±–ª–æ–∫","–∑–∞–¥–µ—Ä–∂–∫–∞","–∏—Å–∫–∞–∂–µ–Ω–∏–µ"], love:["–æ—Ö–ª–∞–∂–¥–µ–Ω–∏–µ","–Ω–µ—è—Å–Ω–æ—Å—Ç—å","–∑–∞–∫—Ä—ã—Ç–æ—Å—Ç—å"], money:["–ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è","–æ—à–∏–±–∫–∞","–∑–∞–¥–µ—Ä–∂–∫–∞"]}
        });
      }
    }
    return out;
  }

  const FULL=[...MAJORS, ...makeMinor()];
  const getCard = (name)=>FULL.find(x=>x.name===name);

  function pickKeys(card, theme, orient){
    const src = orient==="rev" ? card.rev : card.keys;
    const arr = (src && src[theme]) ? src[theme] : (src ? src.general : []);
    return (arr||[]).slice(0,3);
  }

  // --- UI dynamic cards ---
  const container = document.getElementById("cardsContainer");
  const previewWrap = document.getElementById("previewWrap");

  function positionLabels(spread, layout){
    if(spread===2){
      if(layout==="situationadviceoutcome") return ["–°–∏—Ç—É–∞—Ü–∏—è","–°–æ–≤–µ—Ç"];
      if(layout==="pastpresentfuture") return ["–ü—Ä–æ—à–ª–æ–µ","–ë—É–¥—É—â–µ–µ"];
      return ["–ü—Ä–∏—á–∏–Ω–∞","–ò—Ç–æ–≥"];
    }
    if(spread===3){
      if(layout==="situationadviceoutcome") return ["–°–∏—Ç—É–∞—Ü–∏—è","–°–æ–≤–µ—Ç","–ò—Ç–æ–≥"];
      if(layout==="pastpresentfuture") return ["–ü—Ä–æ—à–ª–æ–µ","–ù–∞—Å—Ç–æ—è—â–µ–µ","–ë—É–¥—É—â–µ–µ"];
      return ["–ü—Ä–∏—á–∏–Ω–∞","–°—É—Ç—å","–ò—Ç–æ–≥"];
    }
    return ["–ü—Ä–∏—á–∏–Ω–∞","–°—É—Ç—å","–ß—Ç–æ –ø–æ–º–æ–≥–∞–µ—Ç","–ß—Ç–æ –º–µ—à–∞–µ—Ç","–ò—Ç–æ–≥"];
  }

  function fillSelect(sel){
    FULL.forEach(c=>{
      const opt=document.createElement("option");
      opt.value=c.name; opt.textContent=c.name;
      sel.appendChild(opt);
    });
  }

  function buildCardBlock(i, label){
    const div=document.createElement("div");
    div.innerHTML = `
      <label for="c${i}">–ö–∞—Ä—Ç–∞ ${i} (${label})</label>
      <select id="c${i}"></select>
      <div class="row" style="margin-top:8px">
        <div>
          <label for="o${i}">–ü–æ–ª–æ–∂–µ–Ω–∏–µ</label>
          <select id="o${i}">
            <option value="up">–ü—Ä—è–º–æ–µ</option>
            <option value="rev">–ü–µ—Ä–µ–≤—ë—Ä–Ω—É—Ç–æ–µ</option>
          </select>
        </div>
        <div>
          <label for="t${i}">–¢–µ–º–∞ (–ª–æ–∫–∞–ª—å–Ω–æ)</label>
          <select id="t${i}">
            <option value="inherit" selected>–ö–∞–∫ –æ–±—â–∞—è</option>
            <option value="general">–û–±—â–µ–µ</option>
            <option value="love">–õ—é–±–æ–≤—å</option>
            <option value="money">–î–µ–Ω—å–≥–∏/—Ä–∞–±–æ—Ç–∞</option>
          </select>
        </div>
      </div>
    `;
    return div;
  }

  function renderCards(){
    const spread=parseInt(document.getElementById("spread").value,10);
    const layout=document.getElementById("layout").value;
    const labels=positionLabels(spread,layout);

    container.innerHTML="";
    for(let i=1;i<=spread;i++){
      container.appendChild(buildCardBlock(i,labels[i-1]));
      fillSelect(document.getElementById(`c${i}`));
    }
    const defaults=["0 –®—É—Ç","I –ú–∞–≥","II –ñ—Ä–∏—Ü–∞","VI –í–ª—é–±–ª—ë–Ω–Ω—ã–µ","X –ö–æ–ª–µ—Å–æ –§–æ—Ä—Ç—É–Ω—ã"];
    for(let i=1;i<=spread;i++){
      document.getElementById(`c${i}`).value = defaults[i-1] || FULL[0].name;
    }
    updatePreviews();
  }

  document.getElementById("spread").addEventListener("change", renderCards);
  document.getElementById("layout").addEventListener("change", renderCards);
  container.addEventListener("change", (e)=>{
    if(e.target && (e.target.id.startsWith("c") || e.target.id.startsWith("o") || e.target.id.startsWith("t"))){
      updatePreviews();
    }
  });

  function suitSymbol(card){
    if(card.type==="major") return "‚ú¶";
    if(card.suit.includes("–ñ–µ–∑–ª–æ–≤")) return "üî•";
    if(card.suit.includes("–ö—É–±–∫–æ–≤")) return "üíß";
    if(card.suit.includes("–ú–µ—á–µ–π")) return "üå¨Ô∏è";
    if(card.suit.includes("–ü–µ–Ω—Ç–∞–∫–ª–µ–π")) return "üåø";
    return "‚ú¶";
  }

  function themeLabel(theme){
    return theme==="love" ? "–õ—é–±–æ–≤—å" : (theme==="money" ? "–î–µ–Ω—å–≥–∏/—Ä–∞–±–æ—Ç–∞" : "–û–±—â–µ–µ");
  }

  function getSelection(){
    const spread=parseInt(document.getElementById("spread").value,10);
    const layout=document.getElementById("layout").value;
    const labels=positionLabels(spread,layout);
    const themeAll=document.getElementById("themeAll").value;

    const arr=[];
    for(let i=1;i<=spread;i++){
      const name=document.getElementById(`c${i}`).value;
      const o=document.getElementById(`o${i}`).value;
      const tLocal=document.getElementById(`t${i}`).value;
      const theme = (tLocal==="inherit") ? themeAll : tLocal;
      const card=getCard(name);
      arr.push({i,label:labels[i-1], name, o, theme, card, keys:pickKeys(card,theme,o)});
    }
    return {spread,layout,labels,themeAll,arr};
  }

  function updatePreviews(){
    const {arr,themeAll} = getSelection();
    previewWrap.innerHTML="";
    arr.forEach(x=>{
      const div=document.createElement("div");
      div.className="tarotCard";
      const orient = x.o==="rev" ? "–ü–µ—Ä–µ–≤—ë—Ä–Ω—É—Ç–æ–µ" : "–ü—Ä—è–º–æ–µ";
      div.innerHTML = `
        <div class="tarotTitle">${suitSymbol(x.card)} ${x.name}</div>
        <div class="tarotSub">${x.label} ‚Ä¢ ${orient} ‚Ä¢ ${themeLabel(x.theme==="inherit"?themeAll:x.theme)}</div>
        <div class="tarotKeys">${x.keys.join(" ‚Ä¢ ")}</div>
        <div class="chips">
          <span class="chip">${x.card.type==="major" ? "–°—Ç–∞—Ä—à–∏–π –∞—Ä–∫–∞–Ω" : x.card.suit}</span>
          <span class="chip">–°—á—ë—Ç: ${scoreFor(x.card, x.o)}</span>
        </div>
      `;
      previewWrap.appendChild(div);
    });
  }

  // --- Yes/No scoring ---
  function scoreFor(card, orient){
    const base = (card.score ?? 0);
    return orient==="rev" ? -base : base;
  }

  function yesNoResult(sel){
    const total = sel.arr.reduce((s,x)=>s + scoreFor(x.card,x.o),0);
    const spread=sel.spread;
    const normalized = total / Math.max(1, spread*3); // rough
    let verdict="–°–ú–ï–®–ê–ù–ù–û";
    if(normalized >= 0.45) verdict="–î–ê";
    else if(normalized <= -0.45) verdict="–ù–ï–¢";
    else if(normalized >= 0.15) verdict="–°–ö–û–†–ï–ï –î–ê";
    else if(normalized <= -0.15) verdict="–°–ö–û–†–ï–ï –ù–ï–¢";

    const confidence = Math.min(95, Math.max(55, Math.round(60 + Math.abs(normalized)*70)));
    return {verdict, confidence, total};
  }

  function styleWrap(text){
    const style=document.getElementById("style").value;
    if(style==="short") return text.split("\n").slice(0,8).join("\n");
    if(style==="direct") return text;
    // soft
    return text.replaceAll("–°–æ–≤–µ—Ç:", "–ú—è–≥–∫–∏–π —Å–æ–≤–µ—Ç:");
  }

  // --- Generator for modes ---
  function generateInterpret(sel){
    const themeAll=sel.themeAll;
    const tLabel=themeLabel(themeAll);
    const anyRev=sel.arr.some(x=>x.o==="rev");
    const tone= anyRev ? "–ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞—é—â–∏–π" : "—Ä–µ—Å—É—Ä—Å–Ω—ã–π";
    const majCount = sel.arr.filter(x=>x.card.type==="major").length;

    const title=document.getElementById("title").value.trim();
    const client=document.getElementById("client").value.trim();
    const question=document.getElementById("question").value.trim();
    const meta=[title && `–ú–µ—Ç–∫–∞: ${title}`, client && `–ò–º—è: ${client}`, question && `–í–æ–ø—Ä–æ—Å: ${question}`].filter(Boolean).join("\n");

    const lines = sel.arr.map(x=>`${x.i}) ${x.label} (${x.name}${x.o==="rev"?" ‚ü≤":""}): ${x.keys.join(", ")}.`);

    let synth="";
    if(sel.spread===2){
      const a=sel.arr[0], b=sel.arr[1];
      synth = `–°—é–∂–µ—Ç: ¬´${a.keys[0]||"–∏—Å—Ç–æ–∫–∏"}¬ª –≤–ª–∏—è–µ—Ç –Ω–∞ ¬´${b.keys[0]||"–∏—Ç–æ–≥"}¬ª.\n–ö–ª—é—á: —É—Å–∏–ª–∏–≤–∞–π—Ç–µ ¬´${a.keys[1]||a.keys[0]||"—Ñ–æ–∫—É—Å"}¬ª, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å ¬´${b.keys[1]||b.keys[0]||"—è—Å–Ω–æ—Å—Ç—å"}¬ª.`;
    }else if(sel.spread===3){
      const a=sel.arr[0], b=sel.arr[1], c=sel.arr[2];
      synth = `–°—é–∂–µ—Ç: –∏–∑ ¬´${a.keys[0]||"–∏—Å—Ç–æ–∫–æ–≤"}¬ª –≤—ã –≤—Ö–æ–¥–∏—Ç–µ –≤ ¬´${b.keys[0]||"—Å—É—Ç—å"}¬ª, –∏ —ç—Ç–æ –≤–µ–¥—ë—Ç –∫ ¬´${c.keys[0]||"–∏—Ç–æ–≥—É"}¬ª.\n–ö–ª—é—á: —Ñ–æ–∫—É—Å –Ω–∞ ¬´${b.keys[1]||b.keys[0]||"–≥–ª–∞–≤–Ω–æ–º"}¬ª ‚Üí —Ä–µ–∑—É–ª—å—Ç–∞—Ç ¬´${c.keys[1]||c.keys[0]||"—è—Å–Ω–µ–µ"}¬ª.`;
    }else{
      const a=sel.arr[0], b=sel.arr[1], help=sel.arr[2], block=sel.arr[3], out=sel.arr[4];
      synth = `–°—é–∂–µ—Ç: –ø—Ä–∏—á–∏–Ω–∞ ¬´${a.keys[0]||"–∏—Å—Ç–æ–∫–∏"}¬ª —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç —Å—É—Ç—å ¬´${b.keys[0]||"—è–¥—Ä–æ"}¬ª.\n–ü–æ–º–æ–≥–∞–µ—Ç: ¬´${help.keys[0]||"—Ä–µ—Å—É—Ä—Å"}¬ª. –ú–µ—à–∞–µ—Ç: ¬´${block.keys[0]||"–ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–µ"}¬ª.\n–ò—Ç–æ–≥: –æ–ø–æ—Ä–∞ –Ω–∞ ¬´${help.keys[1]||help.keys[0]||"—Ä–µ—Å—É—Ä—Å"}¬ª –∏ —Å–Ω–∏–∂–µ–Ω–∏–µ ¬´${block.keys[1]||block.keys[0]||"–ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–µ"}¬ª –≤–µ–¥—É—Ç –∫ ¬´${out.keys[0]||"—Ä–µ–∑—É–ª—å—Ç–∞—Ç—É"}¬ª.`;
    }

    let advice = tone==="–ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞—é—â–∏–π"
      ? "–°–æ–≤–µ—Ç: —Å–Ω–∏–∂–∞–π—Ç–µ –∏–º–ø—É–ª—å—Å–∏–≤–Ω–æ—Å—Ç—å, –ø–µ—Ä–µ–ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –¥–æ–≥–æ–≤–æ—Ä—ë–Ω–Ω–æ—Å—Ç–∏ –∏ —Ñ–∞–∫—Ç—ã, –¥–µ–π—Å—Ç–≤—É–π—Ç–µ –ø–æ —à–∞–≥–∞–º."
      : "–°–æ–≤–µ—Ç: –≤—ã–±–µ—Ä–∏—Ç–µ –æ–¥–∏–Ω –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —à–∞–≥ –Ω–∞ –±–ª–∏–∂–∞–π—à–∏–µ 7 –¥–Ω–µ–π (—Å–æ–æ–±—â–µ–Ω–∏–µ/–¥–µ–π—Å—Ç–≤–∏–µ/–ø–ª–∞–Ω) –∏ –∑–∞–∫—Ä–µ–ø–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç.";

    let majorNote="";
    if(majCount>=2) majorNote="‚ö° –ú–Ω–æ–≥–æ –°—Ç–∞—Ä—à–∏—Ö –ê—Ä–∫–∞–Ω–æ–≤: —Å–∏—Ç—É–∞—Ü–∏—è –≤–∞–∂–Ω–∞—è/—Å—É–¥—å–±–æ–Ω–æ—Å–Ω–∞—è ‚Äî —Å–º–æ—Ç—Ä–∏—Ç–µ –Ω–∞ —É—Ä–æ–∫ –∏ –≤—ã–±–æ—Ä.";
    else if(majCount===1) majorNote="‚ú® –ï—Å—Ç—å –°—Ç–∞—Ä—à–∏–π –ê—Ä–∫–∞–Ω: –æ–Ω –∑–∞–¥–∞—ë—Ç –≥–ª–∞–≤–Ω—ã–π —Ñ–æ–Ω –∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ.";

    const header = `–†–∞—Å–∫–ª–∞–¥: ${sel.spread} –∫–∞—Ä—Ç\n–¢–µ–º–∞: ${tLabel}\n–¢–æ–Ω: ${tone}\n–î–∞—Ç–∞: ${new Date().toLocaleString()}\n`;
    const body = `${header}${meta?("\n"+meta+"\n"):"\n"}${lines.join("\n")}\n\n${synth}\n${advice}${majorNote?("\n\n"+majorNote):""}`;
    return body;
  }

  function generateYesNo(sel){
    const q=document.getElementById("question").value.trim();
    const {verdict, confidence, total} = yesNoResult(sel);
    const cardsLine = sel.arr.map(x=>`${x.name}${x.o==="rev"?"‚ü≤":""}`).join(" + ");
    const expl = sel.arr.map(x=>`- ${x.name}${x.o==="rev"?" ‚ü≤":""}: ${x.keys.join(", ")}`).join("\n");
    const text =
`–í–æ–ø—Ä–æ—Å: ${q || "(–Ω–µ —É–∫–∞–∑–∞–Ω)"}\n
–û—Ç–≤–µ—Ç: ${verdict}\n–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å: ~${confidence}%\n–°—É–º–º–∞—Ä–Ω—ã–π –±–∞–ª–∞–Ω—Å: ${total}\n
–ö–∞—Ä—Ç—ã: ${cardsLine}\n
–ü–æ—á–µ–º—É —Ç–∞–∫:\n${expl}\n
–ü–æ–¥—Å–∫–∞–∑–∫–∞: –µ—Å–ª–∏ –æ—Ç–≤–µ—Ç ‚Äú—Å–º–µ—à–∞–Ω–Ω–æ‚Äù, —É—Ç–æ—á–Ω–∏—Ç–µ –≤–æ–ø—Ä–æ—Å –∏ —Å–¥–µ–ª–∞–π—Ç–µ —Ä–∞—Å–∫–ª–∞–¥ –Ω–∞ 5 –∫–∞—Ä—Ç.`;
    return text;
  }

  function generateClient(sel){
    const title=document.getElementById("title").value.trim();
    const client=document.getElementById("client").value.trim();
    const q=document.getElementById("question").value.trim();
    const yn = yesNoResult(sel);
    const ynLine = q ? `–î–∞/–ù–µ—Ç (–ø–æ –±–∞–ª–∞–Ω—Å—É): ${yn.verdict} (~${yn.confidence}%)` : "";
    const base = generateInterpret(sel);

    // Compact ‚Äúreport‚Äù wrapping
    const rep =
`–ö–õ–ò–ï–ù–¢–°–ö–ò–ô –û–¢–ß–Å–¢\n–î–∞—Ç–∞: ${new Date().toLocaleString()}\n${client?("–ö–ª–∏–µ–Ω—Ç: "+client+"\n"):""}${title?("–ú–µ—Ç–∫–∞: "+title+"\n"):""}${q?("–í–æ–ø—Ä–æ—Å: "+q+"\n"):""}${ynLine?("\n"+ynLine+"\n"):""}
------------------------------\n${base}\n
–ö—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ (1‚Äì2 —Ñ—Ä–∞–∑—ã):\n- –ì–ª–∞–≤–Ω–∞—è —Ç–µ–º–∞: ____________________________\n- –°–ª–µ–¥—É—é—â–∏–π —à–∞–≥: __________________________\n`;
    return rep;
  }

  function generate(){
    const mode=document.getElementById("mode").value;
    const sel=getSelection();
    if(mode==="yesno") return styleWrap(generateYesNo(sel));
    if(mode==="client") return styleWrap(generateClient(sel));
    return styleWrap(generateInterpret(sel));
  }

  function showResult(text){
    document.getElementById("txt").textContent=text;
    const out=document.getElementById("out");
    out.style.display="block";
    out.scrollIntoView({behavior:"smooth",block:"start"});
  }

  // Buttons & helpers
  function resetFields(){
    document.getElementById("title").value="";
    document.getElementById("client").value="";
    document.getElementById("question").value="";
  }

  document.getElementById("btnReset").addEventListener("click", ()=>{
    resetFields();
    renderCards();
    alert("–°–±—Ä–æ—à–µ–Ω–æ.");
  });

  document.getElementById("btnDark").addEventListener("click", ()=>{
    document.body.classList.toggle("dark");
  });

  document.getElementById("btnGo").addEventListener("click", ()=>{
    showResult(generate());
  });

  document.getElementById("btnCopy").addEventListener("click", async ()=>{
    const text=generate();
    try{ await navigator.clipboard.writeText(text); alert("–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!"); }
    catch(e){
      const ta=document.createElement("textarea");
      ta.value=text; document.body.appendChild(ta); ta.select();
      document.execCommand("copy"); ta.remove(); alert("–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!");
    }
  });

  document.getElementById("btnPrint").addEventListener("click", ()=>{
    showResult(generate());
    window.print();
  });

  // History
  const KEY="tarot_pwa_history_v3";
  function loadHistory(){ try{return JSON.parse(localStorage.getItem(KEY)||"[]");}catch(e){return [];} }
  function saveHistory(items){ localStorage.setItem(KEY, JSON.stringify(items)); renderHistory(); }
  const nowISO=()=>new Date().toISOString();

  function currentCards(){
    const spread=parseInt(document.getElementById("spread").value,10);
    const arr=[];
    for(let i=1;i<=spread;i++){
      const name=document.getElementById(`c${i}`).value;
      const o=document.getElementById(`o${i}`).value;
      arr.push(name + (o==="rev"?"‚ü≤":""));
    }
    return arr;
  }

  function renderHistory(){
    const box=document.getElementById("history");
    const items=loadHistory();
    if(!items.length){
      box.innerHTML = `<div class="item" style="cursor:default"><b>–ü–æ–∫–∞ –ø—É—Å—Ç–æ</b><small>–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ä–∞—Å–∫–ª–∞–¥, —á—Ç–æ–±—ã –æ–Ω –ø–æ—è–≤–∏–ª—Å—è –∑–¥–µ—Å—å.</small></div>`;
      return;
    }
    box.innerHTML="";
    items.slice().reverse().forEach((it)=>{
      const title = [it.title,it.client].filter(Boolean).join(" ‚Ä¢ ") || `${it.mode} ‚Ä¢ ${it.spread} –∫–∞—Ä—Ç`;
      const date = new Date(it.date).toLocaleString();
      const div=document.createElement("div");
      div.className="item";
      div.innerHTML = `<b>${title}</b><small>${date} ‚Äî ${it.cards.join(" + ")}</small>`;
      div.addEventListener("click", ()=>showResult(it.text));
      box.appendChild(div);
    });
  }

  document.getElementById("btnSave").addEventListener("click", ()=>{
    const text=generate();
    const items=loadHistory();
    items.push({
      date: nowISO(),
      mode: document.getElementById("mode").value,
      spread: parseInt(document.getElementById("spread").value,10),
      title: document.getElementById("title").value.trim(),
      client: document.getElementById("client").value.trim(),
      question: document.getElementById("question").value.trim(),
      cards: currentCards(),
      text
    });
    saveHistory(items);
    showResult(text);
    alert("–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ.");
  });

  document.getElementById("btnClear").addEventListener("click", ()=>{
    if(confirm("–¢–æ—á–Ω–æ –æ—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é?")){ localStorage.removeItem(KEY); renderHistory(); }
  });

  document.getElementById("btnExport").addEventListener("click", async ()=>{
    const data=localStorage.getItem(KEY)||"[]";
    document.getElementById("import").value=data;
    try{ await navigator.clipboard.writeText(data); alert("JSON —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω."); }
    catch(e){ alert("–°–∫–æ–ø–∏—Ä—É–π—Ç–µ JSON –∏–∑ –ø–æ–ª—è –≤—Ä—É—á–Ω—É—é."); }
  });

  document.getElementById("btnImport").addEventListener("click", ()=>{
    const raw=document.getElementById("import").value.trim();
    if(!raw) return;
    try{
      const parsed=JSON.parse(raw);
      if(!Array.isArray(parsed)) throw new Error("not array");
      saveHistory(parsed);
      alert("–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ.");
    }catch(e){ alert("–û—à–∏–±–∫–∞ JSON."); }
  });

  // Init
  renderCards();
  renderHistory();

  // Service worker
  if("serviceWorker" in navigator){
    navigator.serviceWorker.register("./service-worker.js").then(()=>{
      const el=document.getElementById("net");
      el.style.display="block";
      if(!navigator.onLine){ el.textContent="‚úì –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ –æ—Ñ–ª–∞–π–Ω–µ"; }
    }).catch(()=>{
      const el=document.getElementById("net");
      el.style.display="block"; el.classList.add("bad");
      el.textContent="‚ö†Ô∏è Service Worker –Ω–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω (–ø—Ä–æ–≤–µ—Ä—å—Ç–µ HTTPS/—É—Å—Ç–∞–Ω–æ–≤–∫—É)";
    });
  }
</script>
</body>
</html>
